@model List<MarketAnalyticHub.Models.Portfolio.Portfolio>

<div class="col-md-12">
    <div class="card">
        @foreach (var portfolio in Model)
        {
            <div class="card-body">
                <h3>
                    <i class="fas fa-wallet"></i> @portfolio.Name
                </h3>

                @foreach (var stockGroup in portfolio.Items.GroupBy(s => s.Symbol))
                {
                    var positiveEventCount = stockGroup.SelectMany(s => s.StockEvents).Count(e => e.Sentiment == "Positive");
                    var negativeEventCount = stockGroup.SelectMany(s => s.StockEvents).Count(e => e.Sentiment == "Negative");

                    <ul class="list-group mb-3">
                        <li class="list-group-item">
                            <h5>
                                <i class="fas fa-microchip"></i> @stockGroup.Key Analysis (Total: @stockGroup.SelectMany(s => s.StockEvents).Count()) | Positive: @positiveEventCount | Negative: @negativeEventCount
                            </h5>
                        </li>
                        <li class="list-group-item">
                            <button class="btn btn-success btn-toggle" onclick="toggleCollapse('@stockGroup.Key-positive')">
                                <i class="fas fa-arrow-up"></i> Positive Analysis
                            </button>
                            <div id="@stockGroup.Key-positive" class="collapse mt-2">
                                <ul class="list-group">
                                    @foreach (var stock in stockGroup)
                                    {
                                        @foreach (var stockEvent in stock.StockEvents.Where(e => e.Sentiment == "Positive"))
                                        {
                                            <li class="list-group-item">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <p class="card-text"><i class="fas fa-calendar-day"></i> <strong>Date:</strong> <span>@stockEvent.Date</span></p>
                                                        <p class="card-text"><i class="fas fa-chart-line"></i> <strong>Price Change:</strong> <span class="positive">@stockEvent.PriceChange%</span></p>
                                                        <p class="card-text"><i class="fas fa-calendar-check"></i> <strong>Events:</strong> <a href="@stockEvent.Source" class="text-success">Link</a></p>
                                                        <p class="card-text"><i class="fas fa-smile"></i> <strong>Sentiment:</strong> <span class="positive">@stockEvent.Sentiment</span></p>
                                                    </div>
                                                </div>
                                            </li>
                                        }
                                    }
                                </ul>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <button class="btn btn-danger btn-toggle" onclick="toggleCollapse('@stockGroup.Key-negative')">
                                <i class="fas fa-arrow-down"></i> Negative Analysis
                            </button>
                            <div id="@stockGroup.Key-negative" class="collapse mt-2">
                                <ul class="list-group">
                                    @foreach (var stock in stockGroup)
                                    {
                                        @foreach (var stockEvent in stock.StockEvents.Where(e => e.Sentiment == "Negative"))
                                        {
                                            <li class="list-group-item">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <p class="card-text"><i class="fas fa-calendar-day"></i> <strong>Date:</strong> <span>@stockEvent.Date</span></p>
                                                        <p class="card-text"><i class="fas fa-chart-line"></i> <strong>Price Change:</strong> <span class="negative">@stockEvent.PriceChange%</span></p>
                                                        <p class="card-text"><i class="fas fa-calendar-check"></i> <strong>Events:</strong> <a href="@stockEvent.Source" class="text-danger">Link</a></p>
                                                        <p class="card-text"><i class="fas fa-frown"></i> <strong>Sentiment:</strong> <span class="negative">@stockEvent.Sentiment</span></p>
                                                    </div>
                                                </div>
                                            </li>
                                        }
                                    }
                                </ul>
                            </div>
                        </li>
                    </ul>
                }
            </div>
        }
    </div>
</div>
<script>
    function toggleCollapse(id) {
        var element = document.getElementById(id);
        if (element.classList.contains('collapse')) {
            element.classList.remove('collapse');
            element.classList.add('show');
        } else {
            element.classList.remove('show');
            element.classList.add('collapse');
        }
    }
</script>
